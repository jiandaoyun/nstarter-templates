{
  "title": "JSON schema for configuration files",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/config_obj",
  "definitions": {
    "config_obj": {
      "type": "object",
      "additionalProperties": false
    },
    "port_number": {
      "type": "number",
      "maximum": 65535,
      "minimum": 1,
      "multipleOf": 1
    },
    "password_str": {
      "type": "string",
      "minLength": 6
    },
    "service_conf": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "enabled": {
          "type": "boolean"
        }
      }
    },
    "log_level": {
      "type": "string",
      "enum": ["debug", "info", "warn", "error"]
    }
  },
  "properties": {
    "server": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "http": {
          "$ref": "#/definitions/config_obj",
          "description": "Http server configuration.",
          "properties": {
            "port": {
              "$ref": "#/definitions/port_number",
              "description": "Port number for http server to listen to.",
              "default": 3000
            }
          }
        },
        "static": {
          "$ref": "#/definitions/config_obj",
          "properties": {
            "views": {
              "type": "string"
            },
            "public": {
              "type": "string"
            }
          }
        },
        "session": {
          "$ref": "#/definitions/config_obj",
          "description": "Session configurations.",
          "properties": {
            "secret": {
              "$ref": "#/definitions/password_str",
              "description": "Secret for session store."
            },
            "name": {
              "type": "string",
              "description": "Key for session cookie."
            }
          }
        },
        "cookie": {
          "$ref": "#/definitions/config_obj",
          "description": "Cookie configuration.",
          "properties": {
            "policy": {
              "$ref": "#/definitions/config_obj",
              "description": "Cookie store policy.",
              "properties": {
                "httpOnly": {
                  "type": "boolean"
                },
                "signed": {
                  "type": "boolean"
                },
                "secure": {
                  "type": "boolean"
                }
              }
            }
          }
        }
      }
    },
    "database": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "mongodb": {
          "$ref": "#/definitions/config_obj",
          "properties": {
            "mongod": {
              "$ref": "#/definitions/config_obj",
              "properties": {
                "host": {
                  "type": "string"
                },
                "port": {
                  "$ref": "#/definitions/port_number",
                  "description": "Mongodb server port.",
                  "default": 27017
                }
              }
            },
            "user": {
              "type": "string",
              "description": "Mongodb user."
            },
            "password": {
              "$ref": "#/definitions/password_str"
            },
            "db": {
              "type": "string"
            }
          }
        },
        "redis": {
          "$ref": "#/definitions/config_obj",
          "properties": {
            "name": {
              "type": "string"
            },
            "host": {
              "type": "string"
            },
            "port": {
              "$ref": "#/definitions/port_number",
              "default": 6379
            },
            "password": {
              "$ref": "#/definitions/password_str"
            }
          }
        }
      }
    },
    "system": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "locale": {
          "type": "string",
          "enum": ["en_us", "zh_cn"],
          "default": "en_us"
        },
        "timezone": {
          "type": "string",
          "default": "UTC"
        },
        "log": {
          "$ref": "#/definitions/config_obj",
          "properties": {
            "console": {
              "$ref": "#/definitions/config_obj",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "level": {
                  "$ref": "#/definitions/log_level",
                  "default": "info"
                },
                "colorize": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "file": {
              "$ref": "#/definitions/config_obj",
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "level": {
                  "$ref": "#/definitions/log_level",
                  "default": "info"
                },
                "dir": {
                  "type": "string"
                },
                "zip": {
                  "type": "boolean"
                },
                "rotate_days": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 30,
                  "multipleOf": 1,
                  "default": 14
                }
              }
            },
            "graylog": {
              "$ref": "#/definitions/config_obj",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "level": {
                  "$ref": "#/definitions/log_level",
                  "default": "info"
                },
                "servers": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/config_obj",
                    "properties": {
                      "host": {
                        "type": "string"
                      },
                      "port": {
                        "$ref": "#/definitions/port_number",
                        "default": 12201
                      }
                    }
                  },
                  "minItems": 1
                }
              }
            },
            "sentry": {
              "$ref": "#/definitions/config_obj",
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "level": {
                  "$ref": "#/definitions/log_level",
                  "default": "warn"
                },
                "dsn": {
                  "type": "string"
                }
              }
            }
          }
        },
        "req_log": {
          "$ref": "#/definitions/config_obj",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "components": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "grpc": {
          "$ref": "#/definitions/config_obj",
          "description": "gRPC service config",
          "properties": {
            "server": {
              "description": "gRPC server config",
              "$ref": "#/definitions/config_obj",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "port": {
                  "$ref": "#/definitions/port_number",
                  "default": 9050
                }
              }
            },
            "clients": {
              "type": "array",
              "description": "gRPC clients configuration",
              "items": {
                "$ref": "#/definitions/config_obj",
                "properties": {
                  "package": {
                    "type": "string",
                    "description": "gRPC package name."
                  },
                  "address": {
                    "type": "string",
                    "description": "Server address for gRPC package."
                  }
                }
              }
            }
          }
        }
      }
    },
    "service": {
      "$ref": "#/definitions/config_obj",
      "properties": {
        "http": {
          "$ref": "#/definitions/service_conf"
        },
        "mongodb": {
          "$ref": "#/definitions/service_conf"
        },
        "redis": {
          "$ref": "#/definitions/service_conf"
        },
        "websocket": {
          "$ref": "#/definitions/service_conf"
        },
        "cron": {
          "$ref": "#/definitions/service_conf"
        }
      }
    }
  }
}
