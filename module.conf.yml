# Project template module description file
#
# modules:
#   - storage
#   |- rabbitmq
#   |- mongodb
#   |- redis
#   - components
#   |- web
#   |- ws_server
#   |- ws_emitter
#   |- grpc_server
#   |- grpc_client
#   |- cron
#   |- i18n
#   |- mq_producer
#   |- mq_consumer
#   - devops
#   |- graylog
#   |- sentry
#   |- conf_yaml
#   - utils
#   |- util_request
#   `- util_moment

modules:
  - name: mongodb
    label: Mongodb
    type: storage
    default: true
    files:
      - src/components/mongodb.component.ts
      - src/components/lib/database/mongodb.connection.ts
      - src/models/**
      - src/controllers/**
      - src/decorators/mongodb.ts
    config:
      - database.mongodb
    packages:
      - mongoose
      - '@types/mongoose'

  - name: redis
    label: Redis
    type: storage
    default: true
    files:
      - src/components/redis.component.ts
      - src/components/lib/database/redis.connection.ts
      - typings/connect-redis/**
    config:
      - database.redis
    packages:
      - connect-redis
      - ioredis
      - '@types/ioredis'

  - name: rabbitmq
    label: RabbitMQ
    type: stroage
    default: false
    files:
      - src/components/rabbitmq.component.ts
      - src/components/lib/database/rabbitmq.connection.ts
    config:
      - database.rabbitmq
    packages:
      - amqplib
      - '@types/amqplib'
      - querystring

  - name: web
    label: Web HTTP Service
    type: components
    default: true
    files:
      - views/**
      - src/routes/**
      - temp/**
      - public/**
      - typings/express/**

  - name: ws_server
    label: Websocket Server
    type: components
    files:
      - src/components/ws_server.component.ts
      - src/components/lib/websocket/**
    dependencies:
      - redis
    packages:
      - socket.io
      - socket.io-redis
      - '@types/socket.io'
      - '@types/socket.io-redis'

  - name: ws_emitter
    label: Websocket Emitter
    type: components
    files:
      - src/components/ws_emitter.component.ts
      - typings/socket.io-emitter/**
    dependencies:
      - redis
    packages:
      - socket.io-emitter

  - name: cron
    label: Cron Job
    type: components
    files:
      - src/components/cron.component.ts
      - src/plugins/cron_jobs/**
    packages:
      - cron
      - '@types/cron'

  - name: i18n
    label: i18n
    type: components
    files:
      - src/components/i18n.component.ts
      - src/components/lib/i18n.ts
      - typings/i18next-conv/**
      - resources/i18n/**
      - tools/i18n_scan.js
    packages:
      - i18next
      - i18next-conv
      - '@types/i18next'
    scripts:
      - tool:i18n-scan

  - name: grpc_server
    label: gRPC Server
    type: components
    files:
      - src/components/rpc_server.component.ts
      - src/plugins/rpc/services/**
      - src/plugins/rpc/types/**
      - src/plugins/rpc/*
      - src/plugins/rpc/server.ts
      - resources/grpc/**
    packages:
      - grpc
      - '@grpc/proto-loader'
      - prodobufjs
    config:
      - components.grpc.server

  - name: grpc_client
    label: gRPC Client
    type: components
    files:
      - src/components/rpc_client.component.ts
      - src/plugins/rpc/clients/**
      - src/plugins/rpc/types/**
      - src/plugins/rpc/*
      - resources/grpc/**
    packages:
      - grpc
      - '@grpc/proto-loader'
      - prodobufjs
    config:
      - components.grpc.clients

  - name: graylog
    label: Graylog (Logging)
    type: devops
    config:
      - system.log.graylog
    packages:
      - 'winston-graylog2'

  - name: sentry
    label: Sentry (Error tracking)
    type: devops
    files:
      - src/components/lib/logger/transports/sentry.transport.ts
    config:
      - system.log.sentry
    packages:
      - '@sentry/node'

  - name: monitor
    label: Performance monitor(Prometheus)
    type: devops
    files:
      - src/components/monitor.component.ts
      - src/plugins/monitor/**
    conifg:
      - system.monitor
    package:
      - prom-client

  - name: mq_producer
    label: Message Queue Producer
    type: components
    default: false
    files:
      - src/components/mq_producer.component.ts
      - src/plugins/queue/producer/**
      - src/plugins/queue/*

  - name: mq_consumer
    label: Message Queue Consumer
    type: components
    default: false
    files:
      - src/components/mq_consumer.component.ts
      - src/plugins/queue/consumer/**
      - src/plugins/queue/*

  - name: conf_yaml
    label: YAML Config
    type: devops
    default: true
    files:
      - conf.d/*.yaml
    packages:
      - '@types/js-yaml'

  - name: util_request
    label: 'npm: request'
    type: utils
    default: true
    packages:
      - requset

  - name: util_moment
    label: 'npm: moment & moment-timezone'
    type: utils
    default: true
    packages:
      - moment
      - moment-timezone'
      - '@types/moment-timezone'

module_types:
  - name: storage
    label: Data Storage
  - name: components
    label: components
  - name: devops
    label: DevOps Tools
  - name: utils
    label: Utility packages

ignore_files:
  - .git/**
  - .idea/**
  - .vscode/**
  - .nyc_output/**
  - dist/**
  - log/**
  - coverage/**
  - node_modules/**
  - conf.d/config.override.*
  - package-lock.json
  - module.conf.yml
